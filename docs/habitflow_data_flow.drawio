<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" version="21.0.0">
  <diagram name="HabitFlow â€” Data Flow Architecture">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="2800" pageHeight="1960" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             Ð—ÐÐ“ÐžÐ›ÐžÐ’ÐžÐš
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <mxCell id="title" value="&lt;font style=&quot;font-size:20px;&quot;&gt;&lt;b&gt;HabitFlow â€” ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¸ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…&lt;/b&gt;&lt;/font&gt;"
                style="text;html=1;align=center;strokeColor=none;fillColor=none;"
                vertex="1" parent="1">
          <mxGeometry x="50" y="10" width="2650" height="45" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             Ð›Ð•Ð“Ð•ÐÐ”Ð
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <mxCell id="legend_bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="2720" y="60" width="70" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="legend_title" value="&lt;b&gt;Ð›Ð•Ð“Ð•ÐÐ”Ð&lt;/b&gt;" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="2720" y="62" width="70" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="legend_flow" value="" style="endArrow=block;endFill=1;strokeColor=#0050ef;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry x="2725" y="88" width="60" height="10" relative="1" as="geometry">
            <Array as="points"/>
            <mxPoint x="2725" y="88" as="sourcePoint"/>
            <mxPoint x="2785" y="88" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_flow_lbl" value="Flow (Ñ€ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹)" style="text;html=1;align=left;strokeColor=none;fillColor=none;fontSize=8;fontColor=#0050ef;" vertex="1" parent="1">
          <mxGeometry x="2720" y="93" width="70" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="legend_action" value="" style="endArrow=open;endFill=0;strokeColor=#cc4400;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry x="2725" y="115" width="60" height="10" relative="1" as="geometry">
            <mxPoint x="2725" y="115" as="sourcePoint"/>
            <mxPoint x="2785" y="115" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_action_lbl" value="Action (suspend)" style="text;html=1;align=left;strokeColor=none;fillColor=none;fontSize=8;fontColor=#cc4400;" vertex="1" parent="1">
          <mxGeometry x="2720" y="120" width="70" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="legend_state" value="" style="endArrow=block;endFill=1;strokeColor=#007700;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry x="2725" y="142" width="60" height="10" relative="1" as="geometry">
            <mxPoint x="2725" y="142" as="sourcePoint"/>
            <mxPoint x="2785" y="142" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_state_lbl" value="StateFlow â†’ UI" style="text;html=1;align=left;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007700;" vertex="1" parent="1">
          <mxGeometry x="2720" y="147" width="70" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="legend_nav" value="" style="endArrow=block;endFill=1;strokeColor=#9900cc;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry x="2725" y="169" width="60" height="10" relative="1" as="geometry">
            <mxPoint x="2725" y="169" as="sourcePoint"/>
            <mxPoint x="2785" y="169" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_nav_lbl" value="Navigation / Event" style="text;html=1;align=left;strokeColor=none;fillColor=none;fontSize=8;fontColor=#9900cc;" vertex="1" parent="1">
          <mxGeometry x="2720" y="174" width="70" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="legend_auto" value="âš¡ AUTO" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=8;fontColor=#555555;" vertex="1" parent="1">
          <mxGeometry x="2720" y="196" width="70" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="legend_auto_lbl" value="Room â†’ Flow â†’ UI" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=8;fontColor=#555555;" vertex="1" parent="1">
          <mxGeometry x="2720" y="208" width="70" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="legend_auto_lbl2" value="Ð°Ð²Ñ‚Ð¾-Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=8;fontColor=#555555;" vertex="1" parent="1">
          <mxGeometry x="2720" y="220" width="70" height="14" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             Ð¤ÐžÐÐ« Ð¡Ð›ÐžÐÐ’
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- Presentation Layer BG -->
        <mxCell id="bg_pres" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;opacity=40;" vertex="1" parent="1">
          <mxGeometry x="10" y="60" width="2700" height="540" as="geometry"/>
        </mxCell>
        <mxCell id="bg_pres_lbl" value="PRESENTATION LAYER â€” Jetpack Compose Â· ViewModel Â· StateFlow Â· Channel&lt;Event&gt;"
                style="text;html=1;align=left;strokeColor=none;fillColor=none;fontColor=#023878;fontSize=12;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="20" y="64" width="800" height="22" as="geometry"/>
        </mxCell>

        <!-- Domain Layer BG -->
        <mxCell id="bg_dom" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=40;" vertex="1" parent="1">
          <mxGeometry x="10" y="620" width="2700" height="460" as="geometry"/>
        </mxCell>
        <mxCell id="bg_dom_lbl" value="DOMAIN LAYER â€” Pure Kotlin Â· Use Cases Â· Repository Interfaces Â· Domain Models"
                style="text;html=1;align=left;strokeColor=none;fillColor=none;fontColor=#1a5e20;fontSize=12;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="20" y="624" width="800" height="22" as="geometry"/>
        </mxCell>

        <!-- Data Layer BG -->
        <mxCell id="bg_data" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;opacity=40;" vertex="1" parent="1">
          <mxGeometry x="10" y="1100" width="2700" height="440" as="geometry"/>
        </mxCell>
        <mxCell id="bg_data_lbl" value="DATA LAYER â€” Repository Implementations Â· Mappers Â· Room DAOs"
                style="text;html=1;align=left;strokeColor=none;fillColor=none;fontColor=#7a5e00;fontSize=12;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="20" y="1104" width="700" height="22" as="geometry"/>
        </mxCell>

        <!-- Database BG -->
        <mxCell id="bg_db" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;opacity=40;" vertex="1" parent="1">
          <mxGeometry x="10" y="1560" width="2700" height="360" as="geometry"/>
        </mxCell>
        <mxCell id="bg_db_lbl" value="ROOM DATABASE â€” SQLite Â· Ð ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Flow&lt;Entity&gt; Â· ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ UI"
                style="text;html=1;align=left;strokeColor=none;fillColor=none;fontColor=#6d0000;fontSize=12;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="20" y="1564" width="800" height="22" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             Ð ÐÐ—Ð”Ð•Ð›Ð˜Ð¢Ð•Ð›Ð˜ ÐšÐžÐ›ÐžÐÐžÐš
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <mxCell id="sep1" value="" style="line;strokeColor=#9999aa;fillColor=none;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="682" y="60" width="10" height="1860" as="geometry"/>
        </mxCell>
        <mxCell id="sep2" value="" style="line;strokeColor=#9999aa;fillColor=none;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1358" y="60" width="10" height="1860" as="geometry"/>
        </mxCell>
        <mxCell id="sep3" value="" style="line;strokeColor=#9999aa;fillColor=none;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="2034" y="60" width="10" height="1860" as="geometry"/>
        </mxCell>

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº -->
        <mxCell id="ch1" value="â‘  HabitsListScreen" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=11;fontStyle=1;fontColor=#023878;" vertex="1" parent="1">
          <mxGeometry x="20" y="62" width="650" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="ch2" value="â‘¡ HabitInfoScreen" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=11;fontStyle=1;fontColor=#023878;" vertex="1" parent="1">
          <mxGeometry x="690" y="62" width="660" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="ch3" value="â‘¢ CalendarScreen" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=11;fontStyle=1;fontColor=#023878;" vertex="1" parent="1">
          <mxGeometry x="1365" y="62" width="660" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="ch4" value="â‘£ CreateHabitScreen" style="text;html=1;align=center;strokeColor=none;fillColor=none;fontSize=11;fontStyle=1;fontColor=#023878;" vertex="1" parent="1">
          <mxGeometry x="2040" y="62" width="660" height="20" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             ÐšÐžÐ›ÐžÐÐšÐ 1: HabitsListScreen
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Screen -->
        <mxCell id="p_hl_screen" value="&lt;b&gt;HabitsListScreen&lt;/b&gt; (Compose)&lt;hr/&gt;â€¢ collectAsStateWithLifecycle(vm.state)&lt;br&gt;â€¢ LazyColumn â†’ HabitItem (checkbox + title)&lt;br&gt;â€¢ FAB â†’ CreateHabit&lt;br&gt;â€¢ onToggle(habitId) | onHabitClick(id)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="92" width="310" height="90" as="geometry"/>
        </mxCell>

        <!-- ViewModel -->
        <mxCell id="p_hl_vm" value="&lt;b&gt;HabitsListViewModel&lt;/b&gt;&lt;hr/&gt;â€¢ state: StateFlow&lt;HabitsListUiState&gt;&lt;br&gt;â€¢ init { loadHabits() }  â† launchIn(scope)&lt;br&gt;â€¢ loadJob: Job? (Ð¾Ñ‚Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ reload)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b3d4f5;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="360" y="92" width="300" height="90" as="geometry"/>
        </mxCell>

        <!-- UiState -->
        <mxCell id="p_hl_state" value="&lt;b&gt;HabitsListUiState&lt;/b&gt; (sealed)&lt;hr/&gt;â€¢ Loading&lt;br&gt;â€¢ Empty&lt;br&gt;â€¢ Content(habits: List&lt;HabitWithStatus&gt;)&lt;br&gt;â€¢ Error(message: String)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f4fe;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="205" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- HabitWithStatus -->
        <mxCell id="p_hl_hwstatus" value="&lt;b&gt;HabitWithStatus&lt;/b&gt; (UI model)&lt;hr/&gt;â€¢ habit: Habit&lt;br&gt;â€¢ isCompletedToday: Boolean"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f4fe;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="245" y="205" width="200" height="70" as="geometry"/>
        </mxCell>

        <!-- Combine pattern -->
        <mxCell id="p_hl_combine" value="&lt;b&gt;ÐŸÐ°Ñ‚Ñ‚ÐµÑ€Ð½ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸:&lt;/b&gt;&lt;hr/&gt;combine(&lt;br&gt;  getAllActiveHabitsUseCase(),   &lt;i&gt;Flow&lt;List&lt;Habit&gt;&gt;&lt;/i&gt;&lt;br&gt;  getEntriesForDateUseCase(today) &lt;i&gt;Flow&lt;List&lt;HabitEntry&gt;&gt;&lt;/i&gt;&lt;br&gt;) { habits, entries â†’ habitsWithStatus }&lt;br&gt;.onEach { state.value = it }&lt;br&gt;.catch { state.value = Error }&lt;br&gt;.launchIn(viewModelScope)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="460" y="205" width="200" height="125" as="geometry"/>
        </mxCell>

        <!-- Action: Toggle -->
        <mxCell id="p_hl_toggle" value="âš¡ &lt;b&gt;onToggle(habitId)&lt;/b&gt;&lt;hr/&gt;viewModelScope.launch {&lt;br&gt;  toggleHabitEntryUseCase(habitId, today)&lt;br&gt;} â†’ Room UPDATE/INSERT&lt;br&gt;â†’ Flow re-emits Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸&lt;br&gt;â†’ UI recompose"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6794c;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="330" width="310" height="100" as="geometry"/>
        </mxCell>

        <!-- Navigation -->
        <mxCell id="p_hl_nav" value="ðŸ§­ &lt;b&gt;Navigation&lt;/b&gt;&lt;hr/&gt;â†’ CreateHabitScreen (FAB)&lt;br&gt;â†’ HabitInfoScreen(habitId) (Ñ‚Ð°Ð¿)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8d5f5;strokeColor=#9900cc;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="360" y="330" width="290" height="100" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             ÐšÐžÐ›ÐžÐÐšÐ 2: HabitInfoScreen
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Screen -->
        <mxCell id="p_hi_screen" value="&lt;b&gt;HabitInfoScreen&lt;/b&gt; (Compose)&lt;hr/&gt;â€¢ collectAsStateWithLifecycle(vm.state)&lt;br&gt;â€¢ LaunchedEffect(vm.events) â†’ navigation&lt;br&gt;â€¢ ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸: streak, best, %&lt;br&gt;â€¢ WeeklyProgressRow (7 ÐºÑ€ÑƒÐ¶ÐºÐ¾Ð²)&lt;br&gt;â€¢ ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚Ð¼ÐµÑ‚ÐºÐ¸ / ÐÑ€Ñ…Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ / ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑŒ"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="700" y="92" width="310" height="110" as="geometry"/>
        </mxCell>

        <!-- ViewModel -->
        <mxCell id="p_hi_vm" value="&lt;b&gt;HabitInfoViewModel&lt;/b&gt;&lt;hr/&gt;â€¢ habitId: Int (SavedStateHandle[&quot;habitId&quot;])&lt;br&gt;â€¢ state: StateFlow&lt;HabitInfoUiState&gt;&lt;br&gt;â€¢ events: Channel&lt;HabitInfoEvent&gt;&lt;br&gt;â€¢ init { loadHabit() }"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b3d4f5;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1030" y="92" width="300" height="110" as="geometry"/>
        </mxCell>

        <!-- UiState -->
        <mxCell id="p_hi_state" value="&lt;b&gt;HabitInfoUiState&lt;/b&gt; (sealed)&lt;hr/&gt;â€¢ Loading&lt;br&gt;â€¢ Content(&lt;br&gt;    habit: Habit,&lt;br&gt;    statistics: HabitStatistics,&lt;br&gt;    isTodayDone: Boolean,&lt;br&gt;    weeklyEntries: List&lt;HabitEntry&gt;&lt;br&gt;  )&lt;br&gt;â€¢ Error(message)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f4fe;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="700" y="220" width="200" height="145" as="geometry"/>
        </mxCell>

        <!-- Events -->
        <mxCell id="p_hi_events" value="&lt;b&gt;HabitInfoEvent&lt;/b&gt; (sealed)&lt;hr/&gt;â€¢ NavigateBack&lt;br&gt;â€¢ NavigateToCalendar(habitId)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8d5f5;strokeColor=#9900cc;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="915" y="220" width="200" height="80" as="geometry"/>
        </mxCell>

        <!-- Combine pattern -->
        <mxCell id="p_hi_combine" value="&lt;b&gt;ÐŸÐ°Ñ‚Ñ‚ÐµÑ€Ð½ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸:&lt;/b&gt;&lt;hr/&gt;loadHabit() â†’ suspend getHabitByIdUseCase()&lt;br&gt;â†“ habit: Habit (Ð¾Ð´Ð½Ð¾Ñ€Ð°Ð·Ð¾Ð²Ð¾)&lt;br&gt;combine(&lt;br&gt;  getHabitsStatisticsUseCase(habitId),&lt;br&gt;  getEntriesForPeriodUseCase(id, -6d..today)&lt;br&gt;) { stats, entries â†’ Content(...) }&lt;br&gt;.catch { Error }&lt;br&gt;.collect { state.value = it }"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1130" y="220" width="200" height="145" as="geometry"/>
        </mxCell>

        <!-- Actions -->
        <mxCell id="p_hi_actions" value="âš¡ &lt;b&gt;Actions:&lt;/b&gt;&lt;hr/&gt;â€¢ onToggleToday() â†’ toggleHabitEntryUseCase(id, today)&lt;br&gt;â€¢ onArchive() â†’ archiveHabitUseCase(id) â†’ events.send(NavigateBack)&lt;br&gt;â€¢ onNavigateToCalendar() â†’ events.send(NavigateToCalendar(id))"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6794c;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="700" y="380" width="630" height="80" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             ÐšÐžÐ›ÐžÐÐšÐ 3: CalendarScreen
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Screen -->
        <mxCell id="p_cal_screen" value="&lt;b&gt;CalendarScreen&lt;/b&gt; (Compose)&lt;hr/&gt;â€¢ collectAsStateWithLifecycle(vm.state)&lt;br&gt;â€¢ CalendarGrid(month, doneDates)&lt;br&gt;â€¢ Ð¡Ñ‚Ñ€ÐµÐ»ÐºÐ¸ â† â†’ Ð´Ð»Ñ ÑÐ¼ÐµÐ½Ñ‹ Ð¼ÐµÑÑÑ†Ð°&lt;br&gt;â€¢ ÐšÐ»Ð¸Ðº Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ â†’ onDateToggled(date)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1375" y="92" width="310" height="100" as="geometry"/>
        </mxCell>

        <!-- ViewModel -->
        <mxCell id="p_cal_vm" value="&lt;b&gt;CalendarViewModel&lt;/b&gt;&lt;hr/&gt;â€¢ habitId: Int (SavedStateHandle)&lt;br&gt;â€¢ _yearMonth: MutableStateFlow&lt;YearMonth&gt;&lt;br&gt;â€¢ state: StateFlow&lt;CalendarUiState&gt;&lt;br&gt;â€¢ events: Channel&lt;CalendarEvent&gt;"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b3d4f5;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1700" y="92" width="300" height="100" as="geometry"/>
        </mxCell>

        <!-- UiState -->
        <mxCell id="p_cal_state" value="&lt;b&gt;CalendarUiState&lt;/b&gt; (sealed)&lt;hr/&gt;â€¢ Loading&lt;br&gt;â€¢ Content(&lt;br&gt;    habit: Habit,&lt;br&gt;    yearMonth: YearMonth,&lt;br&gt;    doneDates: Set&lt;LocalDate&gt;&lt;br&gt;  )&lt;br&gt;â€¢ Error(message)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f4fe;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1375" y="210" width="200" height="130" as="geometry"/>
        </mxCell>

        <!-- CalendarEvent -->
        <mxCell id="p_cal_event" value="&lt;b&gt;CalendarEvent&lt;/b&gt;&lt;hr/&gt;â€¢ NavigateBack"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8d5f5;strokeColor=#9900cc;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1590" y="210" width="160" height="50" as="geometry"/>
        </mxCell>

        <!-- flatMapLatest pattern -->
        <mxCell id="p_cal_flat" value="&lt;b&gt;Ð ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½ (ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹):&lt;/b&gt;&lt;hr/&gt;_yearMonth&lt;br&gt;  .flatMapLatest { month â†’   â† Ð¾Ñ‚Ð¼ÐµÐ½ÑÐµÑ‚ Ð¿Ñ€ÐµÐ´. Ð·Ð°Ð¿Ñ€Ð¾Ñ!&lt;br&gt;    getEntriesForPeriodUseCase(&lt;br&gt;      id, month.atDay(1), month.atEndOfMonth()&lt;br&gt;    ).map { entries â†’ month to entries }&lt;br&gt;  }&lt;br&gt;  .combine(habitFlow) { (month, entries), habit â†’&lt;br&gt;    Content(habit, month, entries.filter{isDone}.toSet())&lt;br&gt;  }&lt;br&gt;  .onEach { state.value = it }&lt;br&gt;  .launchIn(viewModelScope)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1768" y="210" width="232" height="200" as="geometry"/>
        </mxCell>

        <!-- Actions -->
        <mxCell id="p_cal_actions" value="âš¡ &lt;b&gt;Actions:&lt;/b&gt;&lt;hr/&gt;â€¢ onMonthChanged(ym) â†’ _yearMonth.value = ym â†’ flatMapLatest Ð¾Ñ‚Ð¼ÐµÐ½ÑÐµÑ‚ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹&lt;br&gt;â€¢ onDateToggled(date) â†’ toggleHabitEntryUseCase(habitId, date) â†’ Room re-emits â†’ UI Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ÑÑ"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6794c;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1375" y="360" width="630" height="90" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             ÐšÐžÐ›ÐžÐÐšÐ 4: CreateHabitScreen
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Screen -->
        <mxCell id="p_cr_screen" value="&lt;b&gt;CreateHabitScreen&lt;/b&gt; (Compose)&lt;hr/&gt;â€¢ collectAsStateWithLifecycle(vm.state)&lt;br&gt;â€¢ Scaffold + SnackbarHost&lt;br&gt;â€¢ ÐŸÐ¾Ð»Ñ: title, desc, color, repeat, target&lt;br&gt;â€¢ ExposedDropdown Ð´Ð»Ñ RepeatType&lt;br&gt;â€¢ ÐšÐ½Ð¾Ð¿ÐºÐ° Save (disabled Ð¿Ñ€Ð¸ isSaving)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="2050" y="92" width="310" height="110" as="geometry"/>
        </mxCell>

        <!-- ViewModel -->
        <mxCell id="p_cr_vm" value="&lt;b&gt;CreateHabitViewModel&lt;/b&gt;&lt;hr/&gt;â€¢ state: StateFlow&lt;CreateHabitUiState&gt;&lt;br&gt;â€¢ events: Channel&lt;CreateHabitEvent&gt;&lt;br&gt;â€¢ _state.update { it.copy(...) }"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b3d4f5;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="2375" y="92" width="300" height="110" as="geometry"/>
        </mxCell>

        <!-- UiState -->
        <mxCell id="p_cr_state" value="&lt;b&gt;CreateHabitUiState&lt;/b&gt; (data class)&lt;hr/&gt;â€¢ title: String = &quot;&quot;&lt;br&gt;â€¢ description: String = &quot;&quot;&lt;br&gt;â€¢ color: String = &quot;#FF5733&quot;&lt;br&gt;â€¢ repeatType: RepeatType = Daily&lt;br&gt;â€¢ startDate: LocalDate = now()&lt;br&gt;â€¢ target: Int? = null&lt;br&gt;â€¢ reminder: LocalTime? = null&lt;br&gt;â€¢ isSaving: Boolean = false&lt;br&gt;â€¢ error: String? = null"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f4fe;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="2050" y="220" width="200" height="185" as="geometry"/>
        </mxCell>

        <!-- Event -->
        <mxCell id="p_cr_event" value="&lt;b&gt;CreateHabitEvent&lt;/b&gt;&lt;hr/&gt;â€¢ NavigateToHabitsList"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8d5f5;strokeColor=#9900cc;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="2265" y="220" width="170" height="50" as="geometry"/>
        </mxCell>

        <!-- Save flow -->
        <mxCell id="p_cr_flow" value="&lt;b&gt;ÐŸÐ°Ñ‚Ñ‚ÐµÑ€Ð½ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ:&lt;/b&gt;&lt;hr/&gt;onSave():&lt;br&gt;1. if (title.isBlank()) â†’ error message&lt;br&gt;2. _state.update { isSaving = true }&lt;br&gt;3. addHabitUseCase(Habit(id=0, ...)&lt;br&gt;4. events.send(NavigateToHabitsList)&lt;br&gt;catch: _state.update { isSaving=false, error=msg }"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#4a7cb8;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="2450" y="220" width="230" height="185" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             DOMAIN LAYER: USE CASES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- GetAllActiveHabitsUseCase -->
        <mxCell id="d_uc_getall" value="&lt;b&gt;GetAllActiveHabitsUseCase&lt;/b&gt;&lt;hr/&gt;operator fun invoke(): Flow&lt;List&lt;Habit&gt;&gt;&lt;br&gt;â†’ habitRepository.getAllActiveHabits()"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="655" width="300" height="75" as="geometry"/>
        </mxCell>

        <!-- GetEntriesForDateUseCase -->
        <mxCell id="d_uc_entries_date" value="&lt;b&gt;GetEntriesForDateUseCase&lt;/b&gt;&lt;hr/&gt;operator fun invoke(date): Flow&lt;List&lt;HabitEntry&gt;&gt;&lt;br&gt;â†’ entryRepository.getEntriesForDate(date)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="345" y="655" width="300" height="75" as="geometry"/>
        </mxCell>

        <!-- GetHabitsStatisticsUseCase -->
        <mxCell id="d_uc_stats" value="&lt;b&gt;GetHabitsStatisticsUseCase&lt;/b&gt; ðŸ”¥&lt;hr/&gt;operator fun invoke(habitId): Flow&lt;HabitStatistics&gt;&lt;br&gt;â†’ habitRepo.observeHabitById(id)&lt;br&gt;  .flatMapLatest { habit â†’&lt;br&gt;    entryRepo.getEntriesForPeriod(start=habit.startDate, end=today)&lt;br&gt;    .map { entries â†’ calculateStatistics(habit, entries) }&lt;br&gt;  }&lt;br&gt;ÐœÐµÑ‚Ð¾Ð´Ñ‹: calculateDailyStreak() | calculateWeeklyDaysStreak()&lt;br&gt;        calculateWeeklyCountStreak() | calculatePercent()"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="700" y="648" width="390" height="140" as="geometry"/>
        </mxCell>

        <!-- GetEntriesForPeriodUseCase -->
        <mxCell id="d_uc_period" value="&lt;b&gt;GetHabitEntriesForPeriodUseCase&lt;/b&gt;&lt;hr/&gt;operator fun invoke(id, start, end):&lt;br&gt;  Flow&lt;List&lt;HabitEntry&gt;&gt;&lt;br&gt;â†’ entryRepository.getEntriesForPeriod(...)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1105" y="648" width="290" height="90" as="geometry"/>
        </mxCell>

        <!-- ToggleHabitEntryUseCase -->
        <mxCell id="d_uc_toggle" value="&lt;b&gt;ToggleHabitEntryUseCase&lt;/b&gt; âš ï¸&lt;hr/&gt;suspend operator fun invoke(habitId, date):&lt;br&gt;&lt;b&gt;ÐŸÐ ÐÐ’Ð˜Ð›Ðž:&lt;/b&gt; if (date &gt; today) â†’ Exception!&lt;br&gt;getEntryByDate(habitId, date)&lt;br&gt;â€¢ null â†’ addEntry(isDone=true)&lt;br&gt;â€¢ exists â†’ updateEntry(!isDone)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1410" y="648" width="300" height="115" as="geometry"/>
        </mxCell>

        <!-- AddHabitUseCase -->
        <mxCell id="d_uc_add" value="&lt;b&gt;AddHabitUseCase&lt;/b&gt;&lt;hr/&gt;suspend operator fun invoke(habit):&lt;br&gt;â†’ habitRepository.addHabit(habit)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1725" y="648" width="230" height="75" as="geometry"/>
        </mxCell>

        <!-- ArchiveHabitUseCase -->
        <mxCell id="d_uc_archive" value="&lt;b&gt;ArchiveHabitUseCase&lt;/b&gt;&lt;hr/&gt;suspend operator fun invoke(habitId):&lt;br&gt;â†’ habitRepository.archiveHabit(habitId)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1970" y="648" width="240" height="75" as="geometry"/>
        </mxCell>

        <!-- GetHabitByIdUseCase -->
        <mxCell id="d_uc_byid" value="&lt;b&gt;GetHabitByIdUseCase&lt;/b&gt;&lt;hr/&gt;suspend operator fun invoke(id): Habit?&lt;br&gt;â†’ habitRepository.getHabitById(id)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="2225" y="648" width="240" height="75" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             DOMAIN LAYER: REPOSITORY INTERFACES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitRepository interface -->
        <mxCell id="d_repo_habit" value="&lt;b&gt;HabitRepository&lt;/b&gt; (interface)&lt;hr/&gt;â€¢ getAllActiveHabits(): Flow&lt;List&lt;Habit&gt;&gt;&lt;br&gt;â€¢ getArchivedHabits(): Flow&lt;List&lt;Habit&gt;&gt;&lt;br&gt;â€¢ observeHabitById(id): Flow&lt;Habit?&gt;&lt;br&gt;â€¢ suspend getHabitById(id): Habit?&lt;br&gt;â€¢ suspend addHabit(habit)&lt;br&gt;â€¢ suspend updateHabit(habit)&lt;br&gt;â€¢ suspend archiveHabit(id)&lt;br&gt;â€¢ suspend restoreHabit(id)&lt;br&gt;â€¢ suspend deleteHabit(id)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c5;strokeColor=#5c9e55;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="810" width="320" height="195" as="geometry"/>
        </mxCell>

        <!-- HabitEntryRepository interface -->
        <mxCell id="d_repo_entry" value="&lt;b&gt;HabitEntryRepository&lt;/b&gt; (interface)&lt;hr/&gt;â€¢ getEntriesForHabit(id): Flow&lt;List&lt;HabitEntry&gt;&gt;&lt;br&gt;â€¢ getEntriesForPeriod(id, start, end): Flow&lt;&gt;&lt;br&gt;â€¢ getEntriesForDate(date): Flow&lt;List&lt;HabitEntry&gt;&gt;&lt;br&gt;â€¢ suspend addEntry(entry)&lt;br&gt;â€¢ suspend updateEntry(id, date, isDone)&lt;br&gt;â€¢ suspend getEntryByDate(id, date): HabitEntry?"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c5;strokeColor=#5c9e55;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="370" y="810" width="340" height="165" as="geometry"/>
        </mxCell>

        <!-- Domain Models: Habit -->
        <mxCell id="d_model_habit" value="&lt;b&gt;Habit&lt;/b&gt; (domain model)&lt;hr/&gt;id: Int&lt;br&gt;title: String&lt;br&gt;description: String?&lt;br&gt;color: String (Hex)&lt;br&gt;startDate: LocalDate&lt;br&gt;repeatType: RepeatType&lt;br&gt;reminder: LocalTime?&lt;br&gt;target: Int?&lt;br&gt;isArchived: Boolean"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e1;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="730" y="810" width="185" height="190" as="geometry"/>
        </mxCell>

        <!-- Domain Models: HabitEntry -->
        <mxCell id="d_model_entry" value="&lt;b&gt;HabitEntry&lt;/b&gt;&lt;hr/&gt;id: Int&lt;br&gt;habitId: Int (FK)&lt;br&gt;date: LocalDate&lt;br&gt;isDone: Boolean"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e1;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="930" y="810" width="165" height="100" as="geometry"/>
        </mxCell>

        <!-- Domain Models: RepeatType -->
        <mxCell id="d_model_repeat" value="&lt;b&gt;RepeatType&lt;/b&gt; (sealed)&lt;hr/&gt;â€¢ Daily&lt;br&gt;â€¢ WeeklyDays(days: List&lt;DayOfWeek&gt;)&lt;br&gt;â€¢ WeeklyCount(count: Int)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e1;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1110" y="810" width="220" height="90" as="geometry"/>
        </mxCell>

        <!-- Domain Models: HabitStatistics -->
        <mxCell id="d_model_stats" value="&lt;b&gt;HabitStatistics&lt;/b&gt;&lt;hr/&gt;currentStreak: Int&lt;br&gt;bestStreak: Int&lt;br&gt;percentCompletion: Float"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e1;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1345" y="810" width="200" height="90" as="geometry"/>
        </mxCell>

        <!-- UserPreferencesRepository -->
        <mxCell id="d_repo_prefs" value="&lt;b&gt;UserPreferencesRepository&lt;/b&gt;&lt;hr/&gt;â€¢ isOnBoardingCompleted(): Flow&lt;Boolean&gt;&lt;br&gt;â€¢ suspend setOnBoardingCompleted()"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c5;strokeColor=#5c9e55;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1560" y="810" width="280" height="90" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             DATA LAYER: REPOSITORY IMPLEMENTATIONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitRepositoryImpl -->
        <mxCell id="da_repo_habit" value="&lt;b&gt;HabitRepositoryImpl&lt;/b&gt;&lt;hr/&gt;@Inject constructor(dao: HabitDao, mapper: HabitMapper)&lt;br&gt;getAllActiveHabits():&lt;br&gt;  dao.getAllActiveHabits()&lt;br&gt;  .map { list â†’ list.map(mapper::toHabit) }&lt;br&gt;addHabit(habit):&lt;br&gt;  dao.addHabit(mapper.toEntity(habit))"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;align=left;verticalAlign=top;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="1130" width="340" height="150" as="geometry"/>
        </mxCell>

        <!-- HabitEntryRepositoryImpl -->
        <mxCell id="da_repo_entry" value="&lt;b&gt;HabitEntryRepositoryImpl&lt;/b&gt;&lt;hr/&gt;@Inject constructor(dao: HabitEntryDao, mapper: HabitEntryMapper)&lt;br&gt;getEntriesForPeriod(id, start, end):&lt;br&gt;  dao.getEntriesForPeriod(id, start.toString(), end.toString())&lt;br&gt;  .map { list â†’ list.map(mapper::toEntry) }&lt;br&gt;addEntry(entry): dao.addEntry(mapper.toEntity(entry))"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;align=left;verticalAlign=top;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="390" y="1130" width="380" height="150" as="geometry"/>
        </mxCell>

        <!-- HabitMapper -->
        <mxCell id="da_mapper_habit" value="&lt;b&gt;HabitMapper&lt;/b&gt;&lt;hr/&gt;mapHabitEntityToHabit(entity) â†’ Habit:&lt;br&gt;â€¢ repeatType: String â†’ sealed RepeatType&lt;br&gt;â€¢ repeatDays: &quot;MON,WED&quot; â†’ List&lt;DayOfWeek&gt;&lt;br&gt;â€¢ startDate: String â†’ LocalDate&lt;br&gt;â€¢ reminder: String? â†’ LocalTime?&lt;br&gt;mapHabitToHabitEntity(habit) â†’ Entity:&lt;br&gt;â€¢ RepeatType â†’ String + repeatDays String"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe9b3;strokeColor=#c8a000;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="1300" width="340" height="170" as="geometry"/>
        </mxCell>

        <!-- HabitEntryMapper -->
        <mxCell id="da_mapper_entry" value="&lt;b&gt;HabitEntryMapper&lt;/b&gt;&lt;hr/&gt;mapEntityToEntry(entity) â†’ HabitEntry:&lt;br&gt;â€¢ date: String â†’ LocalDate&lt;br&gt;mapEntryToEntity(entry) â†’ Entity:&lt;br&gt;â€¢ date: LocalDate â†’ String (ISO)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe9b3;strokeColor=#c8a000;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="390" y="1300" width="280" height="110" as="geometry"/>
        </mxCell>

        <!-- HabitDao -->
        <mxCell id="da_dao_habit" value="&lt;b&gt;HabitDao&lt;/b&gt; (@Dao)&lt;hr/&gt;@Query getAllActiveHabits(): Flow&lt;List&lt;HabitEntity&gt;&gt;&lt;br&gt;@Query getArchivedHabits(): Flow&lt;&gt;&lt;br&gt;@Query observeHabitById(id): Flow&lt;HabitEntity?&gt;&lt;br&gt;@Query getHabitById(id): HabitEntity? (suspend)&lt;br&gt;@Insert addHabit(entity) (suspend)&lt;br&gt;@Update updateHabit(entity) (suspend)&lt;br&gt;@Query archiveHabit(id) â†’ UPDATE isArchived=1&lt;br&gt;@Query deleteHabit(id) â†’ DELETE"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6794c;fontSize=10;align=left;verticalAlign=top;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="800" y="1130" width="340" height="195" as="geometry"/>
        </mxCell>

        <!-- HabitEntryDao -->
        <mxCell id="da_dao_entry" value="&lt;b&gt;HabitEntryDao&lt;/b&gt; (@Dao)&lt;hr/&gt;@Query getEntriesForHabit(id): Flow&lt;&gt;&lt;br&gt;@Query getEntriesForPeriod(id,start,end): Flow&lt;&gt;&lt;br&gt;@Query getEntriesForDate(date): Flow&lt;&gt;&lt;br&gt;@Query getEntryByDate(id,date): HabitEntryEntity?&lt;br&gt;@Insert addEntry(entity) (suspend)&lt;br&gt;@Query updateEntry(id,date,isDone) (suspend)&lt;br&gt;   â†’ UPDATE habit_entries SET isDone=?"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6794c;fontSize=10;align=left;verticalAlign=top;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="1160" y="1130" width="340" height="195" as="geometry"/>
        </mxCell>

        <!-- DI Info -->
        <mxCell id="da_di" value="&lt;b&gt;Hilt DI&lt;/b&gt; (Ð¸Ð½ÑŠÐµÐºÑ†Ð¸Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹)&lt;hr/&gt;&lt;b&gt;RepositoryModule:&lt;/b&gt;&lt;br&gt;@Binds HabitRepository â†’ HabitRepositoryImpl&lt;br&gt;@Binds HabitEntryRepository â†’ HabitEntryRepositoryImpl&lt;br&gt;&lt;br&gt;&lt;b&gt;DatabaseModule:&lt;/b&gt;&lt;br&gt;@Provides HabitDatabase (Singleton)&lt;br&gt;@Provides HabitDao = db.habitDao()&lt;br&gt;@Provides HabitEntryDao = db.habitEntryDao()"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0e6ff;strokeColor=#9900cc;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1520" y="1130" width="340" height="195" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             ROOM DATABASE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitDatabase -->
        <mxCell id="db_database" value="&lt;b&gt;HabitDatabase&lt;/b&gt;&lt;hr/&gt;@Database(entities=[HabitEntity, HabitEntryEntity], version=1)&lt;br&gt;abstract class extends RoomDatabase&lt;br&gt;Room.databaseBuilder(context, &quot;habit_database&quot;)"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;align=left;verticalAlign=top;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="30" y="1595" width="370" height="100" as="geometry"/>
        </mxCell>

        <!-- HabitEntity / TABLE: habits -->
        <mxCell id="db_table_habits" value="&lt;b&gt;TABLE: habits&lt;/b&gt; (HabitEntity)&lt;hr/&gt;id           INTEGER PK AUTOINCREMENT&lt;br&gt;title        TEXT NOT NULL&lt;br&gt;description  TEXT&lt;br&gt;startDate    TEXT (ISO: &quot;2024-01-15&quot;)&lt;br&gt;color        TEXT (&quot;#FF5733&quot;)&lt;br&gt;isArchived   INTEGER (0/1)&lt;br&gt;repeatType   TEXT (&quot;DAILY&quot;/&quot;WEEKLY_DAYS&quot;/&quot;WEEKLY_COUNT&quot;)&lt;br&gt;repeatDays   TEXT (&quot;MON,WED,FRI&quot;)&lt;br&gt;repeatCount  INTEGER&lt;br&gt;reminder     TEXT (ISO LocalTime)&lt;br&gt;target       INTEGER"
                style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffd7d7;strokeColor=#b85450;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="420" y="1595" width="340" height="285" as="geometry"/>
        </mxCell>

        <!-- HabitEntryEntity / TABLE: habit_entries -->
        <mxCell id="db_table_entries" value="&lt;b&gt;TABLE: habit_entries&lt;/b&gt; (HabitEntryEntity)&lt;hr/&gt;id       INTEGER PK AUTOINCREMENT&lt;br&gt;habitId  INTEGER NOT NULL&lt;br&gt;         FK(habits.id) ON DELETE CASCADE&lt;br&gt;         INDEX for fast lookup&lt;br&gt;date     TEXT (ISO: &quot;2024-01-15&quot;)&lt;br&gt;isDone   INTEGER (0/1)"
                style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffd7d7;strokeColor=#b85450;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="780" y="1595" width="340" height="170" as="geometry"/>
        </mxCell>

        <!-- Room Reactive note -->
        <mxCell id="db_reactive_note" value="âš¡ &lt;b&gt;Room Ð ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ&lt;/b&gt;&lt;hr/&gt;Ð›ÑŽÐ±Ð¾Ðµ INSERT/UPDATE/DELETE&lt;br&gt;Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚&lt;br&gt;Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½ÑƒÑŽ ÑÐ¼Ð¸ÑÑÐ¸ÑŽ Ð²ÑÐµÑ…&lt;br&gt;Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Flow Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº&lt;br&gt;Ð·Ð°Ñ‚Ñ€Ð¾Ð½ÑƒÑ‚Ñ‹Ð¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°Ð¼.&lt;br&gt;&lt;br&gt;Ð­Ñ‚Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼&lt;br&gt;offline-first Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹!"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;align=left;verticalAlign=top;fontStyle=1;"
                vertex="1" parent="1">
          <mxGeometry x="1140" y="1595" width="240" height="180" as="geometry"/>
        </mxCell>

        <!-- Offline-first note -->
        <mxCell id="db_offline_note" value="ðŸŒ &lt;b&gt;Offline-First Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿&lt;/b&gt;&lt;hr/&gt;â€¢ UI Ð’Ð¡Ð•Ð“Ð”Ð Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð¸Ð· Room&lt;br&gt;â€¢ Retrofit Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¢ÐžÐ›Ð¬ÐšÐž&lt;br&gt;  Ð´Ð»Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼&lt;br&gt;â€¢ ViewModel ÐÐ• Ð·Ð½Ð°ÐµÑ‚ Ð¾ ÑÐµÑ‚Ð¸&lt;br&gt;â€¢ ÐŸÑ€Ð¸ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ðµ: Ð¿Ð¾Ð±ÐµÐ¶Ð´Ð°ÐµÑ‚&lt;br&gt;  Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ&lt;br&gt;â€¢ ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð¾ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾&lt;br&gt;  Ð±ÐµÐ· Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð° Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e1;strokeColor=#5c9e55;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1400" y="1595" width="240" height="200" as="geometry"/>
        </mxCell>

        <!-- Business rules note -->
        <mxCell id="db_rules_note" value="ðŸ“œ &lt;b&gt;Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° (UseCase)&lt;/b&gt;&lt;hr/&gt;â€¢ ÐÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ Ð±ÑƒÐ´ÑƒÑ‰Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹&lt;br&gt;â€¢ Streak Daily: Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐµ&lt;br&gt;â€¢ Streak WeeklyDays: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð´Ð½Ð¸&lt;br&gt;â€¢ Streak WeeklyCount: Ð¿Ð¾ Ð¸Ñ‚Ð¾Ð³Ñƒ Ð½ÐµÐ´ÐµÐ»Ð¸&lt;br&gt;â€¢ % = Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ðµ / Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð´Ð½Ð¸&lt;br&gt;â€¢ ÐÑ€Ñ…Ð¸Ð²: ÑÐºÑ€Ñ‹Ñ‚ Ð¸Ð· Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…, ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ&lt;br&gt;â€¢ Ð¡Ð¼ÐµÐ½Ð° Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ Ð½Ðµ Ð»Ð¾Ð¼Ð°ÐµÑ‚ Ð¿Ñ€Ð¾ÑˆÐ»ÑƒÑŽ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ"
                style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;align=left;verticalAlign=top;"
                vertex="1" parent="1">
          <mxGeometry x="1660" y="1595" width="360" height="200" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             FLOW ARROWS: PRESENTATION â†’ DOMAIN
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitsList: Screen â†’ ViewModel (StateFlow) -->
        <mxCell id="e_hl_sv" value="collectAsStateWithLifecycle()" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#007700;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hl_vm" target="p_hl_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitsList: ViewModel â†’ GetAllActiveHabitsUseCase -->
        <mxCell id="e_hl_uc1" value="invoke() â†’ Flow" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hl_vm" target="d_uc_getall" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitsList: ViewModel â†’ GetEntriesForDateUseCase -->
        <mxCell id="e_hl_uc2" value="invoke(today)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hl_vm" target="d_uc_entries_date" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitsList: onToggle â†’ ToggleHabitEntryUseCase -->
        <mxCell id="e_hl_toggle" value="onToggle() suspend" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="p_hl_toggle" target="d_uc_toggle" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitInfo: ViewModel â†’ GetHabitsStatisticsUseCase -->
        <mxCell id="e_hi_uc_stats" value="invoke(habitId)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hi_vm" target="d_uc_stats" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitInfo: ViewModel â†’ GetEntriesForPeriodUseCase -->
        <mxCell id="e_hi_uc_period" value="invoke(id,-6d..today)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hi_vm" target="d_uc_period" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitInfo: ViewModel â†’ GetHabitByIdUseCase -->
        <mxCell id="e_hi_uc_byid" value="suspend invoke(id)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="p_hi_vm" target="d_uc_byid" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitInfo: ArchiveAction â†’ ArchiveUseCase -->
        <mxCell id="e_hi_archive" value="onArchive()" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="p_hi_actions" target="d_uc_archive" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitInfo StateFlow â†’ Screen -->
        <mxCell id="e_hi_sv" value="StateFlow â†’ collectAsStateWithLifecycle" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#007700;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hi_vm" target="p_hi_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Calendar: ViewModel â†’ GetHabitByIdUseCase -->
        <mxCell id="e_cal_byid" value="habitFlow" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="p_cal_vm" target="d_uc_byid" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Calendar: ViewModel â†’ GetEntriesForPeriod -->
        <mxCell id="e_cal_period" value="flatMapLatest(month)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_cal_vm" target="d_uc_period" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Calendar StateFlow â†’ Screen -->
        <mxCell id="e_cal_sv" value="StateFlow â†’ UI" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#007700;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_cal_vm" target="p_cal_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- CreateHabit: onSave â†’ AddHabitUseCase -->
        <mxCell id="e_cr_add" value="onSave() suspend" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="p_cr_flow" target="d_uc_add" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- CreateHabit StateFlow â†’ Screen -->
        <mxCell id="e_cr_sv" value="StateFlow â†’ UI" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#007700;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_cr_vm" target="p_cr_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             FLOW ARROWS: DOMAIN â†’ DATA
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- GetAllActiveHabitsUseCase â†’ HabitRepository interface -->
        <mxCell id="e_uc_repo_habit1" value="getAllActiveHabits()" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="d_uc_getall" target="d_repo_habit" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- GetEntriesForDate â†’ HabitEntryRepository -->
        <mxCell id="e_uc_repo_entry1" value="getEntriesForDate()" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="d_uc_entries_date" target="d_repo_entry" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- GetHabitsStatisticsUseCase â†’ HabitRepository + HabitEntryRepository -->
        <mxCell id="e_stats_repo" value="observeHabitById() + getEntriesForPeriod()" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="d_uc_stats" target="d_repo_entry" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- GetEntriesForPeriod â†’ HabitEntryRepository -->
        <mxCell id="e_period_repo" value="getEntriesForPeriod()" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#0050ef;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="d_uc_period" target="d_repo_entry" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ToggleHabitEntryUseCase â†’ HabitEntryRepository -->
        <mxCell id="e_toggle_repo" value="getEntryByDate() + add/update" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="d_uc_toggle" target="d_repo_entry" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- AddHabitUseCase â†’ HabitRepository -->
        <mxCell id="e_add_repo" value="addHabit()" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="d_uc_add" target="d_repo_habit" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ArchiveHabitUseCase â†’ HabitRepository -->
        <mxCell id="e_archive_repo" value="archiveHabit(id)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#cc4400;strokeWidth=2;dashed=1;fontSize=8;endArrow=open;endFill=0;" edge="1" source="d_uc_archive" target="d_repo_habit" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             FLOW ARROWS: DATA INTERFACES â†’ IMPLEMENTATIONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitRepository â†’ HabitRepositoryImpl -->
        <mxCell id="e_repo_impl_habit" value="@Binds (Hilt)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#9900cc;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="d_repo_habit" target="da_repo_habit" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitEntryRepository â†’ HabitEntryRepositoryImpl -->
        <mxCell id="e_repo_impl_entry" value="@Binds (Hilt)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#9900cc;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="d_repo_entry" target="da_repo_entry" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             FLOW ARROWS: REPO IMPLS â†’ DAOs + MAPPERS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitRepositoryImpl â†’ HabitMapper -->
        <mxCell id="e_impl_mapper_habit" value="map entity â†” domain" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#c8a000;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="da_repo_habit" target="da_mapper_habit" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitRepositoryImpl â†’ HabitDao -->
        <mxCell id="e_impl_dao_habit" value="DAO calls" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#d6794c;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="da_repo_habit" target="da_dao_habit" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitEntryRepositoryImpl â†’ HabitEntryMapper -->
        <mxCell id="e_impl_mapper_entry" value="map entity â†” domain" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#c8a000;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="da_repo_entry" target="da_mapper_entry" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitEntryRepositoryImpl â†’ HabitEntryDao -->
        <mxCell id="e_impl_dao_entry" value="DAO calls" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#d6794c;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="da_repo_entry" target="da_dao_entry" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             FLOW ARROWS: DAOs â†’ ROOM DB
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitDao â†’ HabitDatabase (SQL) -->
        <mxCell id="e_dao_db_habit" value="SQL queries" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#b85450;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="da_dao_habit" target="db_table_habits" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitEntryDao â†’ habit_entries table -->
        <mxCell id="e_dao_db_entry" value="SQL queries" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#b85450;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="da_dao_entry" target="db_table_entries" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Room DB reactive emit back up -->
        <mxCell id="e_db_reactive" value="âš¡ Flow re-emit (Ð°Ð²Ñ‚Ð¾)" style="edgeStyle=orthogonalEdgeStyle;strokeColor=#007700;strokeWidth=3;dashed=1;fontSize=9;endArrow=block;endFill=1;entryX=1;entryY=0.5;exitX=1;exitY=0.5;" edge="1" source="db_table_habits" target="da_dao_habit" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1200" y="1688"/>
              <mxPoint x="1200" y="1228"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             NAVIGATION FLOW (Ð¼ÐµÐ¶Ð´Ñƒ ÑÐºÑ€Ð°Ð½Ð°Ð¼Ð¸)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- HabitsList â†’ HabitInfo (Ñ‚Ð°Ð¿) -->
        <mxCell id="nav_hl_hi" value="â†’ habit_info/{habitId}" style="edgeStyle=elbowEdgeStyle;strokeColor=#9900cc;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hl_nav" target="p_hi_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitsList â†’ CreateHabit (FAB) -->
        <mxCell id="nav_hl_cr" value="â†’ create_habit (FAB)" style="edgeStyle=elbowEdgeStyle;strokeColor=#9900cc;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hl_nav" target="p_cr_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitInfo â†’ Calendar -->
        <mxCell id="nav_hi_cal" value="â†’ calendar/{habitId}" style="edgeStyle=elbowEdgeStyle;strokeColor=#9900cc;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;" edge="1" source="p_hi_events" target="p_cal_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- HabitInfo â†’ Back -->
        <mxCell id="nav_hi_back" value="NavigateBack" style="edgeStyle=elbowEdgeStyle;strokeColor=#9900cc;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;dashed=1;" edge="1" source="p_hi_events" target="p_hl_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- CreateHabit â†’ Back (after save) -->
        <mxCell id="nav_cr_back" value="NavigateToHabitsList" style="edgeStyle=elbowEdgeStyle;strokeColor=#9900cc;strokeWidth=2;fontSize=8;endArrow=block;endFill=1;dashed=1;" edge="1" source="p_cr_event" target="p_hl_screen" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
